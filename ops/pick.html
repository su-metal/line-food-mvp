<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>受取消込｜お得袋</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto;margin:0;padding:16px}
  .card{max-width:560px;margin:0 auto;border:1px solid #eee;border-radius:12px;padding:16px}
  input{width:100%;font-size:18px;padding:12px;border:1px solid #ccc;border-radius:10px}
  button{width:100%;padding:12px;margin-top:12px;font-size:18px;border:0;border-radius:10px;background:#2b8a3e;color:#fff;cursor:pointer}
  .muted{color:#777;margin-top:8px}
  .ok{color:#2b8a3e;font-weight:600}
  .ng{color:#c92a2a;font-weight:600}
</style>
</head>
<body>
<div class="card">
  <h2 style="margin:0 0 8px 0">受取消込</h2>
  <div class="muted">お客様の受取コードを入力してください。</div>
  <input id="code" placeholder="例：6P70V9" autocomplete="one-time-code" />
  <button id="btn">受取を確定する</button>
  <div id="msg" class="muted"></div>
</div>

<script>
const API_BASE = "https://line-food-mvp.vercel.app"; // ←あなたのAPIドメイン

async function pickup() {
  const btn = document.getElementById('btn');
  const code = document.getElementById('code').value.trim().toUpperCase();
  const msg = document.getElementById('msg');
  if(!code){ msg.textContent = "コードを入力してください"; return; }

  btn.disabled = true; btn.textContent = "送信中…"; msg.textContent = "";

  try{
    const r = await fetch(API_BASE + "/api/pickup", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ pickup_code: code })
    });
    const data = await r.json();
    if(data.ok){
      msg.innerHTML = `<span class="ok">受取を確定しました。</span>`;
      document.getElementById('code').value = "";
    }else{
      msg.innerHTML = `<span class="ng">エラー：${data.error||'invalid_or_used'}</span>`;
    }
  }catch(e){
    msg.innerHTML = `<span class="ng">通信エラー：${e.message}</span>`;
  }finally{
    btn.disabled = false; btn.textContent = "受取を確定する";
  }
}
document.getElementById('btn').addEventListener('click', pickup);
document.getElementById('code').addEventListener('keydown', e => { if(e.key==='Enter') pickup(); });
</script>
</body>
</html>
